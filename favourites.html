<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Favourites</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    .grain::before{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      opacity:.18;
      mix-blend-mode:overlay;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='260' height='260'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='260' height='260' filter='url(%23n)' opacity='.55'/%3E%3C/svg%3E");
    }
    .caps{letter-spacing:.22em;}
  </style>
</head>

<body class="min-h-screen bg-slate-950 text-slate-900">
  <div class="relative min-h-screen overflow-hidden">

    <!-- Background -->
    <div class="absolute inset-0">
      <div class="absolute -left-32 top-10 h-[520px] w-[520px] rounded-full bg-cyan-300/25 blur-[90px]"></div>
      <div class="absolute left-40 top-24 h-[540px] w-[540px] rounded-full bg-sky-600/25 blur-[100px]"></div>
      <div class="absolute right-[-140px] bottom-[-140px] h-[620px] w-[620px] rounded-full bg-slate-900/70 blur-[80px]"></div>
      <div class="absolute inset-0 bg-gradient-to-b from-black/10 via-black/30 to-black/70"></div>
      <div class="grain absolute inset-0"></div>
    </div>

    <!-- Content -->
    <div class="relative mx-auto max-w-6xl px-6 py-10">
      <!-- Header -->
      <div class="flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between">
        <div>
          <div class="flex items-center gap-2">
            <!-- Back button (same styling as your pills) -->
            <button id="backBtn"
              class="rounded-full bg-white/10 px-4 py-2 text-[12px] font-semibold text-white/80 hover:bg-white/15 active:bg-white/20 transition"
              type="button">
              ← Back
            </button>

            <div class="text-[12px] font-semibold uppercase caps text-white/75">Favourites</div>
          </div>

          <div class="mt-3 text-[40px] leading-none font-black tracking-tight text-white">
            Your saved <span class="text-white/90">go-to spots</span>
            <span class="ml-4 text-[16px] font-semibold text-white/70">demo list</span>
          </div>

          <div class="mt-3 text-[11px] text-white/55 max-w-[62ch]">
            Tap <span class="font-semibold text-white/70">Show on map</span> to jump back to the main map page and auto-focus the pin.
          </div>
        </div>

        <div class="flex flex-col items-start sm:items-end gap-2">
          <div class="flex flex-wrap items-center gap-2">
            <button id="clearFavsBtn"
              class="rounded-full bg-white/10 px-4 py-2 text-[12px] font-semibold text-white/80 hover:bg-white/15 active:bg-white/20 transition"
              type="button">
              Reset demo
            </button>

            <button id="exportFavsBtn"
              class="rounded-full bg-white/10 px-4 py-2 text-[12px] font-semibold text-white/80 hover:bg-white/15 active:bg-white/20 transition"
              type="button">
              Export (JSON)
            </button>
          </div>

          <div id="statusNote" class="text-[10px] text-white/45 sm:text-right max-w-[320px]">
            Demo mode: favourites are stored in <span class="font-semibold">localStorage</span>.
          </div>
        </div>
      </div>

      <!-- Favourites grid -->
      <div class="mt-10 grid grid-cols-1 lg:grid-cols-3 gap-6">
        <section class="lg:col-span-2 rounded-[26px] bg-white/55 backdrop-blur-xl ring-1 ring-white/25 shadow-[0_20px_60px_rgba(0,0,0,0.35)] overflow-hidden">
          <div class="px-6 pt-6 pb-4 border-b border-black/10">
            <div class="flex items-center justify-between gap-3">
              <div>
                <div class="text-[11px] font-semibold uppercase caps text-slate-800/80">Saved list</div>
                <h2 class="mt-1 text-[22px] font-extrabold tracking-tight text-slate-950">Favourite places</h2>
              </div>
              <div class="text-[11px] text-slate-700/70">
                Click a card to view details
              </div>
            </div>
          </div>

          <div class="p-6">
            <div id="favList" class="space-y-3"></div>
          </div>
        </section>

        <!-- Details panel -->
        <aside class="rounded-[26px] bg-white/55 backdrop-blur-xl ring-1 ring-white/25 shadow-[0_20px_60px_rgba(0,0,0,0.35)] overflow-hidden">
          <div class="px-6 pt-6 pb-4 border-b border-black/10">
            <div>
              <div class="text-[11px] font-semibold uppercase caps text-slate-800/80">Details</div>
              <h2 class="mt-1 text-[22px] font-extrabold tracking-tight text-slate-950">Quick view</h2>
            </div>
          </div>

          <div class="p-6 space-y-4">
            <div id="detailEmpty" class="text-[12px] text-slate-700/70">
              Select a favourite to see more.
            </div>

            <div id="detailCard" class="hidden rounded-[18px] bg-white/45 ring-1 ring-black/10 p-4">
              <div class="flex items-start justify-between gap-3">
                <div class="min-w-0">
                  <div id="dName" class="text-[16px] font-extrabold tracking-tight text-slate-950 truncate">—</div>
                  <div id="dMeta" class="mt-1 text-[11px] text-slate-700/70">—</div>
                  <div id="dAddr" class="mt-2 text-[11px] text-slate-700/65">—</div>
                </div>
                <a id="dWebsite" href="#" target="_blank" rel="noreferrer"
                   class="shrink-0 rounded-full bg-black/10 px-3 py-1 text-[11px] font-semibold text-slate-800/80 hover:bg-black/15 active:bg-black/20 transition">
                  Website
                </a>
              </div>

              <div class="mt-4 rounded-[14px] bg-black/5 p-3">
                <div class="text-[10px] font-semibold uppercase tracking-[0.18em] text-slate-700/70">Review</div>
                <div id="dReview" class="mt-1 text-[11px] text-slate-800/80">—</div>
              </div>

              <div class="mt-4 flex flex-wrap gap-2">
                <button id="showOnMapBtn"
                  class="rounded-full bg-black/10 px-4 py-2 text-[12px] font-semibold text-slate-900 hover:bg-black/15 active:bg-black/20 transition"
                  type="button">
                  Show on map
                </button>

                <a id="openMapsBtn" href="#" target="_blank" rel="noreferrer"
                   class="rounded-full bg-black/10 px-4 py-2 text-[12px] font-semibold text-slate-900 hover:bg-black/15 active:bg-black/20 transition">
                  Open in Maps
                </a>
              </div>

              <div class="mt-3 text-[10px] text-slate-700/60">
                “Show on map” returns to <code class="rounded bg-black/10 px-1.5 py-0.5">index.html</code> and drops a pin.
              </div>
            </div>
          </div>
        </aside>
      </div>

      <div class="mt-8 text-center text-[11px] tracking-wide text-white/45">
        Grey Day • JourneyHacks
      </div>
    </div>
  </div>

  <script>
    /* -------------------------------------------------------
      FAVOURITES PAGE (demo)
      - Stores favourites in localStorage: "GREYDAY_FAVS"
      - "Show on map" navigates to index.html with query params:
          index.html?focus=1&lat=..&lng=..&name=..&zoom=15
      - On your index.html, you’ll add a tiny handler to read these
        params and pan/zoom + drop a marker (snippet below).
    -------------------------------------------------------- */

    const STORAGE_KEY = "GREYDAY_FAVS";

    function escapeHtml(str) {
      return String(str ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    // Demo favourites (Vancouver-ish)
    function getDemoFavourites() {
      return [
        {
          id: "fav_1",
          name: "Rain City Coffee",
          rating: 4.7,
          reviewsCount: 312,
          reviewText: "Cozy seating, clean aesthetic, and espresso that hits every time.",
          website: "https://example.com/rain-city-coffee",
          address: "Downtown Vancouver",
          lat: 49.2829,
          lng: -123.1185
        },
        {
          id: "fav_2",
          name: "Vinyl Listening Bar",
          rating: 4.6,
          reviewsCount: 128,
          reviewText: "Dim lights, perfect playlists, and cocktails that feel premium.",
          website: "https://example.com/vinyl-listening-bar",
          address: "Gastown",
          lat: 49.2836,
          lng: -123.1068
        },
        {
          id: "fav_3",
          name: "Candle & Scent Lab",
          rating: 4.8,
          reviewsCount: 76,
          reviewText: "Niche scents and calm vibes — feels like a reset button on rainy days.",
          website: "https://example.com/candle-scent-lab",
          address: "Mount Pleasant",
          lat: 49.2638,
          lng: -123.1001
        },
        {
          id: "fav_4",
          name: "Comfort Bowl House",
          rating: 4.5,
          reviewsCount: 501,
          reviewText: "Huge portions. Exactly the heavy meal you want when it’s cold out.",
          website: "https://example.com/comfort-bowl-house",
          address: "Main Street",
          lat: 49.2624,
          lng: -123.1014
        }
      ];
    }

    function loadFavs() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return null;
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed)) return null;
        return parsed;
      } catch (e) {
        console.warn("[favs] load error", e);
        return null;
      }
    }

    function saveFavs(list) {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
      } catch (e) {
        console.warn("[favs] save error", e);
      }
    }

    function starRow(rating) {
      const r = Math.max(0, Math.min(5, Number(rating || 0)));
      const full = Math.round(r); // simple demo (round to nearest)
      let s = "";
      for (let i = 1; i <= 5; i++) s += (i <= full ? "★" : "☆");
      return `<span class="font-semibold text-slate-900/70">${s}</span>`;
    }

    function mapsUrlFor(name, placeId) {
      // If you later store a real place_id, you can use it here
      return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(name || "place")}`;
    }

    function renderList(items) {
      const list = document.getElementById("favList");
      if (!items.length) {
        list.innerHTML = `<div class="text-[12px] text-slate-700/70">No favourites yet.</div>`;
        return;
      }

      list.innerHTML = items.map((p) => {
        const meta = `★ ${Number(p.rating).toFixed(1)} (${p.reviewsCount || 0})`;
        return `
          <button
            type="button"
            data-id="${escapeHtml(p.id)}"
            class="w-full text-left rounded-[18px] bg-white/45 ring-1 ring-black/10 p-4 hover:bg-white/55 transition"
          >
            <div class="flex items-start justify-between gap-3">
              <div class="min-w-0">
                <div class="text-[15px] font-extrabold tracking-tight text-slate-950 truncate">
                  ${escapeHtml(p.name)}
                </div>

                <div class="mt-1 flex flex-wrap items-center gap-2 text-[11px] text-slate-700/70">
                  <span class="font-semibold text-slate-900/70">${escapeHtml(meta)}</span>
                  <span class="text-slate-700/50">•</span>
                  <span>${escapeHtml(p.address || "")}</span>
                </div>

                <div class="mt-3 rounded-[14px] bg-black/5 p-3">
                  <div class="text-[10px] font-semibold uppercase tracking-[0.18em] text-slate-700/70">Quick take</div>
                  <div class="mt-1 text-[11px] text-slate-800/80">
                    “${escapeHtml(String(p.reviewText || "").slice(0, 140))}${(p.reviewText && p.reviewText.length > 140) ? "…" : ""}”
                  </div>
                </div>
              </div>

              <a
                href="${escapeHtml(p.website || "#")}"
                target="_blank"
                rel="noreferrer"
                class="shrink-0 rounded-full bg-black/10 px-3 py-1 text-[11px] font-semibold text-slate-800/80 hover:bg-black/15 active:bg-black/20 transition"
                onclick="event.stopPropagation();"
              >
                Website
              </a>
            </div>
          </button>
        `;
      }).join("");
    }

    function setDetails(p) {
      const empty = document.getElementById("detailEmpty");
      const card = document.getElementById("detailCard");
      const dName = document.getElementById("dName");
      const dMeta = document.getElementById("dMeta");
      const dAddr = document.getElementById("dAddr");
      const dWebsite = document.getElementById("dWebsite");
      const dReview = document.getElementById("dReview");
      const showBtn = document.getElementById("showOnMapBtn");
      const openMaps = document.getElementById("openMapsBtn");

      if (!p) {
        empty.classList.remove("hidden");
        card.classList.add("hidden");
        return;
      }

      empty.classList.add("hidden");
      card.classList.remove("hidden");

      dName.textContent = p.name || "—";
      dMeta.innerHTML = `${starRow(p.rating)} <span class="text-slate-700/60">•</span> <span class="text-slate-700/70">${Number(p.rating).toFixed(1)} / 5</span> <span class="text-slate-700/50">•</span> <span class="text-slate-700/70">${p.reviewsCount || 0} reviews</span>`;
      dAddr.textContent = p.address || "—";
      dReview.textContent = p.reviewText || "—";

      dWebsite.href = p.website || "#";
      dWebsite.style.pointerEvents = p.website ? "auto" : "none";
      dWebsite.style.opacity = p.website ? "1" : "0.5";

      openMaps.href = mapsUrlFor(p.name);
      showBtn.onclick = () => goToMapFocus(p);
    }

    function goToMapFocus(p) {
      // Send data to index.html via URL params
      const url = new URL("./index.html", window.location.href);
      url.searchParams.set("focus", "1");
      url.searchParams.set("lat", String(p.lat));
      url.searchParams.set("lng", String(p.lng));
      url.searchParams.set("zoom", "15");
      url.searchParams.set("name", p.name || "Favourite");
      window.location.href = url.toString();
    }

    function exportJson(items) {
      const blob = new Blob([JSON.stringify(items, null, 2)], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "greyday-favourites.json";
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(() => URL.revokeObjectURL(a.href), 800);
    }

    window.addEventListener("DOMContentLoaded", () => {
      // Back button
      document.getElementById("backBtn").addEventListener("click", () => {
        window.location.href = "./index.html";
      });

      // Load favourites or seed demo
      let favs = loadFavs();
      if (!favs) {
        favs = getDemoFavourites();
        saveFavs(favs);
      }

      renderList(favs);
      setDetails(null);

      // Click card -> details
      document.getElementById("favList").addEventListener("click", (e) => {
        const btn = e.target.closest("button[data-id]");
        if (!btn) return;
        const id = btn.getAttribute("data-id");
        const picked = favs.find(x => x.id === id);
        setDetails(picked);
      });

      // Reset demo
      document.getElementById("clearFavsBtn").addEventListener("click", () => {
        favs = getDemoFavourites();
        saveFavs(favs);
        renderList(favs);
        setDetails(null);
        document.getElementById("statusNote").textContent = "Reset to demo favourites.";
      });

      // Export JSON
      document.getElementById("exportFavsBtn").addEventListener("click", () => {
        exportJson(favs);
      });
    });
  </script>

  <!-- -------------------------------------------------------
    IMPORTANT: Add this tiny snippet to your index.html (main map page)
    so it reads the focus params and drops a marker / pans the map.
    Put it AFTER Leaflet is initialized (after your `map` exists).
  -------------------------------------------------------- -->
  <!--
  <script>
    (function focusFromFavourites() {
      const p = new URLSearchParams(window.location.search);
      if (p.get("focus") !== "1") return;

      const lat = Number(p.get("lat"));
      const lng = Number(p.get("lng"));
      const zoom = Number(p.get("zoom") || 15);
      const name = p.get("name") || "Favourite";

      if (!isFinite(lat) || !isFinite(lng)) return;

      // Assumes your Leaflet map variable is called `map`
      // and Leaflet is loaded on index.html.
      if (window.map && typeof window.map.setView === "function") {
        window.map.setView([lat, lng], zoom);

        // Optional: keep a single focus marker
        if (window.__focusMarker) {
          window.map.removeLayer(window.__focusMarker);
        }
        window.__focusMarker = L.marker([lat, lng]).addTo(window.map).bindPopup(name).openPopup();
      }
    })();
  </script>
  -->
</body>
</html>
